<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>swagon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="我的代码很烂">
<meta property="og:type" content="website">
<meta property="og:title" content="swagon">
<meta property="og:url" content="yoursite.com/page/4/index.html">
<meta property="og:site_name" content="swagon">
<meta property="og:description" content="我的代码很烂">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="swagon">
<meta name="twitter:description" content="我的代码很烂">
  
    <link rel="alternative" href="/atom.xml" title="swagon" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img lazy-src="" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">swagon</a></h1>
		</hgroup>

		
		<p class="header-subtitle">原谅我不堪回首的过去</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">swagon</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">swagon</h1>
			</hgroup>
			
			<p class="header-subtitle">原谅我不堪回首的过去</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-基本概念" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/31/基本概念/" class="article-date">
  	<time datetime="2015-07-31T03:28:55.000Z" itemprop="datePublished">7月 31 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="基本概念">基本概念</h3><ul>
<li><p>编译和链接</p>
<ol>
<li><p>编译：文本形式源代码翻译为机器语言形式的目标文件过程</p>
</li>
<li><p>链接:目标文件、操作系统的启动代码和用到的库文件进行组织最终形成可执行代码的过程</p>
<p> <img src="/Users/apple/source/_posts/基本概念/编译和链接.jpg" alt="编译和链接"></p>
</li>
</ol>
<p>​</p>
<ol>
<li>预编译程序所完成的基本上是对源程序的”替换”工作。经过此替换后，生成一个没有宏定义、没有条件编译指令、没有特殊符号的输出文件。这个文件的含义同没有经过预处理的源文件是相同的，但内容有所不同。下一步，此输出文件将作为编译程序的输出而被翻译成为机器指令。</li>
<li>替换-&gt;中间代码或者是汇编代码-&gt;优化一部分是对中间代码的优化，这种优化不依赖于具体的计算机。另一种优化则主要针对目标代码的生成而进行的,这种优化与硬件环境有莫大的关系。 <ol>
<li>优化：最主要的是考虑是如何充分利用机器的各个硬件寄存器存放的有关变量的值</li>
</ol>
</li>
</ol>
</li>
<li><p>汇编</p>
<ol>
<li>汇编语言变成目标机器指令的过程，生成目标文件, 目标文件中所存放的也就是与源程序等效的目标的机器语言代码。通常一个目标文件中至少有两个段：代码段和数据段</li>
</ol>
</li>
<li><p>链接</p>
<p>链接程序的主要工作就是将有关的目标文件彼此相连接</p>
<p>​</p>
<p>​</p>
<p>​</p>
<p>​</p>
<p>​</p>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-restful_api" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/29/restful_api/" class="article-date">
  	<time datetime="2015-07-29T07:07:59.000Z" itemprop="datePublished">7月 29 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="RESTful_Api">RESTful Api</h2><ol>
<li>REST，即Representational State Transfer的缩写。我对这个词组的翻译是”表现层状态转化”</li>
<li>我这篇文章的写作目的，就是想在符合架构原理的前提下，理解和评估以网络为基础的应用软件的架构设计，得到一个功能强、性能好、适宜通信的架构</li>
<li>“表现层”其实指的是”资源”（Resources）的”表现层”。</li>
<li>互联网通信协议HTTP协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-pragma_mark_-_getter" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/17/pragma_mark_-_getter/" class="article-date">
  	<time datetime="2015-07-17T06:45:00.000Z" itemprop="datePublished">7月 17 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>@implementation DOPDropDownMenu</p>
<h1 id="pragma_mark_-_getter">pragma mark - getter</h1><ul>
<li><p>(UIColor *)indicatorColor {<br>  if (!_indicatorColor) {</p>
<pre><code><span class="attribute">_indicatorColor </span>=<span class="string"> [UIColor blackColor];</span>
</code></pre><p>  }<br>  return _indicatorColor;<br>}</p>
</li>
<li><p>(UIColor *)textColor {<br>  if (!_textColor) {</p>
<pre><code><span class="attribute">_textColor </span>=<span class="string"> [UIColor blackColor];</span>
</code></pre><p>  }<br>  return _textColor;<br>}</p>
</li>
<li><p>(UIColor *)separatorColor {<br>  if (!_separatorColor) {</p>
<pre><code><span class="attribute">_separatorColor </span>=<span class="string"> [UIColor blackColor];</span>
</code></pre><p>  }<br>  return _separatorColor;<br>}</p>
</li>
<li><p>(NSString <em>)titleForRowAtIndexPath:(DOPIndexPath </em>)indexPath {<br>  return [self.dataSource menu:self titleForRowAtIndexPath:indexPath];<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_setter">pragma mark - setter</h1><ul>
<li><p>(void)setDataSource:(id<dopdropdownmenudatasource>)dataSource {<br>  _dataSource = dataSource;</dopdropdownmenudatasource></p>
<p>  //configure view<br>  if ([_dataSource respondsToSelector:@selector(numberOfColumnsInMenu:)]) {</p>
<pre><code><span class="constant">_numOfMenu </span>= [<span class="constant">_dataSource </span><span class="symbol">numberOfColumnsInMenu:</span><span class="keyword">self</span>];
</code></pre><p>  } else {</p>
<pre><code><span class="attribute">_numOfMenu </span>=<span class="string"> 1;</span>
</code></pre><p>  }</p>
<p>  CGFloat textLayerInterval = self.frame.size.width / ( _numOfMenu * 2);<br>  CGFloat bgLayerInterval = self.frame.size.width / _numOfMenu;</p>
<p>  NSMutableArray <em>tempTitles = [[NSMutableArray alloc] initWithCapacity:_numOfMenu];<br>  NSMutableArray </em>tempIndicators = [[NSMutableArray alloc] initWithCapacity:_numOfMenu];<br>  NSMutableArray *tempBgLayers = [[NSMutableArray alloc] initWithCapacity:_numOfMenu];</p>
<p>  for (int i = 0; i &lt; _numOfMenu; i++) {</p>
<pre><code><span class="comment">//bgLayer</span>
<span class="built_in">CGPoint</span> bgLayerPosition = <span class="built_in">CGPointMake</span>((i+<span class="number">0.5</span>)*bgLayerInterval, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span>/<span class="number">2</span>);
<span class="built_in">CALayer</span> *bgLayer = [<span class="keyword">self</span> createBgLayerWithColor:[<span class="built_in">UIColor</span> whiteColor] andPosition:bgLayerPosition];
[<span class="keyword">self</span><span class="variable">.layer</span> addSublayer:bgLayer];
[tempBgLayers addObject:bgLayer];
<span class="comment">//title</span>
<span class="built_in">CGPoint</span> titlePosition = <span class="built_in">CGPointMake</span>( (i * <span class="number">2</span> + <span class="number">1</span>) * textLayerInterval , <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span> / <span class="number">2</span>);
<span class="built_in">NSString</span> *titleString = [_dataSource menu:<span class="keyword">self</span> titleForRowAtIndexPath:[DOPIndexPath indexPathWithCol:i row:<span class="number">0</span>]];
<span class="built_in">CATextLayer</span> *title = [<span class="keyword">self</span> createTextLayerWith<span class="built_in">NSString</span>:titleString withColor:<span class="keyword">self</span><span class="variable">.textColor</span> andPosition:titlePosition];
[<span class="keyword">self</span><span class="variable">.layer</span> addSublayer:title];
[tempTitles addObject:title];
<span class="comment">//indicator</span>
<span class="built_in">CAShapeLayer</span> *indicator = [<span class="keyword">self</span> createIndicatorWithColor:<span class="keyword">self</span><span class="variable">.indicatorColor</span> andPosition:<span class="built_in">CGPointMake</span>(titlePosition<span class="variable">.x</span> + title<span class="variable">.bounds</span><span class="variable">.size</span><span class="variable">.width</span> / <span class="number">2</span> + <span class="number">8</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span> / <span class="number">2</span>)];
[<span class="keyword">self</span><span class="variable">.layer</span> addSublayer:indicator];
[tempIndicators addObject:indicator];
</code></pre><p>  }<br>  _titles = [tempTitles copy];<br>  _indicators = [tempIndicators copy];<br>  _bgLayers = [tempBgLayers copy];<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_init_method">pragma mark - init method</h1><ul>
<li><p>(instancetype)initWithOrigin:(CGPoint)origin andHeight:(CGFloat)height {<br>  CGSize screenSize = [UIScreen mainScreen].bounds.size;<br>  self = [self initWithFrame:CGRectMake(origin.x, origin.y, screenSize.width, height)];<br>  if (self) {</p>
<pre><code>_origin = origin;
_currentSelectedMenudIndex = -<span class="number">1</span>;
_show = <span class="literal">NO</span>;

<span class="comment">//tableView init</span>
_tableView = [[<span class="built_in">UITableView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(origin<span class="variable">.x</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.origin</span><span class="variable">.y</span> + <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span>, <span class="number">0</span>) style:<span class="built_in">UITableViewStylePlain</span>];
_tableView<span class="variable">.rowHeight</span> = <span class="number">38</span>;
_tableView<span class="variable">.dataSource</span> = <span class="keyword">self</span>;
_tableView<span class="variable">.delegate</span> = <span class="keyword">self</span>;
_tableView<span class="variable">.separatorStyle</span>=<span class="built_in">UITableViewCellSeparatorStyleNone</span>;
<span class="comment">//self tapped</span>
<span class="keyword">self</span><span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> whiteColor];
<span class="built_in">UIGestureRecognizer</span> *tapGesture = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(menuTapped:)];
[<span class="keyword">self</span> addGestureRecognizer:tapGesture];

<span class="comment">//background init and tapped</span>
_backGroundView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(origin<span class="variable">.x</span>, origin<span class="variable">.y</span>, screenSize<span class="variable">.width</span>, screenSize<span class="variable">.height</span>)];
_backGroundView<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> colorWithWhite:<span class="number">0.0</span> alpha:<span class="number">0.0</span>];
_backGroundView<span class="variable">.opaque</span> = <span class="literal">NO</span>;
<span class="built_in">UIGestureRecognizer</span> *gesture = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(backgroundTapped:)];
[_backGroundView addGestureRecognizer:gesture];

<span class="comment">//add bottom shadow</span>
<span class="built_in">UIView</span> *bottomShadow = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span>-<span class="number">0.5</span>, screenSize<span class="variable">.width</span>, <span class="number">0.5</span>)];
bottomShadow<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> lightGrayColor];
[<span class="keyword">self</span> addSubview:bottomShadow];
</code></pre><p>  }<br>  return self;<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_init_support">pragma mark - init support</h1><ul>
<li><p>(CALayer <em>)createBgLayerWithColor:(UIColor </em>)color andPosition:(CGPoint)position {<br>  CALayer *layer = [CALayer layer];<br>  layer.position = position;<br>  layer.bounds = CGRectMake(0, 0, self.frame.size.width/self.numOfMenu, self.frame.size.height-1);<br>  layer.backgroundColor = color.CGColor;<br>//    NSLog(@”bglayer bounds:%@”,NSStringFromCGRect(layer.bounds));<br>//    NSLog(@”bglayer position:%@”, NSStringFromCGPoint(position));</p>
<p>  return layer;<br>}</p>
</li>
<li><p>(CAShapeLayer <em>)createIndicatorWithColor:(UIColor </em>)color andPosition:(CGPoint)point {<br>  UIImage<em>    backgroundImage = [UIImage imageNamed:@”my”];<br>  CAShapeLayer</em>    layer = [CAShapeLayer new];<br>  CGFloat nativeWidth = CGImageGetWidth(backgroundImage.CGImage);<br>  CGFloat nativeHeight = CGImageGetHeight(backgroundImage.CGImage);<br>  CGRect      startFrame = CGRectMake(0.0, 0.0, nativeWidth, nativeHeight);<br>  layer.contents = (id)backgroundImage.CGImage;<br>  layer.frame = startFrame;<br>  layer.position = point;<br>  return layer;<br>}</p>
</li>
<li><p>(CATextLayer <em>)createTextLayerWithNSString:(NSString </em>)string withColor:(UIColor *)color andPosition:(CGPoint)point {</p>
<p>  CGSize size = [self calculateTitleSizeWithString:string];</p>
<p>  CATextLayer *layer = [CATextLayer new];<br>  CGFloat sizeWidth = (size.width &lt; (self.frame.size.width / _numOfMenu) - 25) ? size.width : self.frame.size.width / _numOfMenu - 25;<br>  layer.bounds = CGRectMake(0, 0, sizeWidth, size.height);<br>  layer.string = string;<br>  layer.fontSize = 14.0;<br>  layer.alignmentMode = kCAAlignmentCenter;<br>  layer.foregroundColor = color.CGColor;</p>
<p>  layer.contentsScale = [[UIScreen mainScreen] scale];</p>
<p>  layer.position = point;</p>
<p>  return layer;<br>}</p>
</li>
<li><p>(CGSize)calculateTitleSizeWithString:(NSString <em>)string<br>{<br>  CGFloat fontSize = 14.0;<br>  NSDictionary </em>dic = @{NSFontAttributeName: [UIFont systemFontOfSize:fontSize]};<br>  CGSize size = [string boundingRectWithSize:CGSizeMake(280, 0) options:NSStringDrawingTruncatesLastVisibleLine | NSStringDrawingUsesLineFragmentOrigin | NSStringDrawingUsesFontLeading attributes:dic context:nil].size;<br>  return size;<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_gesture_handle">pragma mark - gesture handle</h1><ul>
<li><p>(void)menuTapped:(UITapGestureRecognizer *)paramSender {<br>  CGPoint touchPoint = [paramSender locationInView:self];<br>  //calculate index<br>  NSInteger tapIndex = touchPoint.x / (self.frame.size.width / _numOfMenu);</p>
<p>  for (int i = 0; i &lt; _numOfMenu; i++) {</p>
<pre><code><span class="tag">if</span> (i != tapIndex) {
    <span class="attr_selector">[self animateIndicator:_indicators[i]</span> <span class="tag">Forward</span><span class="pseudo">:NO</span> <span class="tag">complete</span>:^{
        <span class="attr_selector">[self animateTitle:_titles[i]</span> <span class="tag">show</span><span class="pseudo">:NO</span> <span class="tag">complete</span>:^{

        }];
    }];
    <span class="attr_selector">[(CALayer *)self.bgLayers[i]</span> <span class="tag">setBackgroundColor</span>:<span class="attr_selector">[UIColor whiteColor]</span><span class="class">.CGColor</span>];
}
</code></pre><p>  }</p>
<p>  if (tapIndex == _currentSelectedMenudIndex &amp;&amp; _show) {</p>
<pre><code><span class="collection">[self animateIdicator:_indicators<span class="collection">[_currentSelectedMenudIndex]</span> background:_backGroundView tableView:_tableView title:_titles<span class="collection">[_currentSelectedMenudIndex]</span> forward:NO complecte:<span class="comment">^{
    _currentSelectedMenudIndex = tapIndex;
    _show = NO;
}</span>]</span><span class="comment">;</span>
<span class="collection">[<span class="list">(<span class="keyword">CALayer</span> *)</span>self.bgLayers<span class="collection">[tapIndex]</span> setBackgroundColor:<span class="collection">[UIColor whiteColor]</span>.CGColor]</span><span class="comment">;</span>
</code></pre><p>  } else {</p>
<pre><code>_currentSelectedMenudIndex = tapIndex;
[_tableView reloadData];
[self <span class="string">animateIdicator:</span>_indicators[tapIndex] <span class="string">background:</span>_backGroundView <span class="string">tableView:</span>_tableView <span class="string">title:</span>_titles[tapIndex] <span class="string">forward:</span>YES <span class="string">complecte:</span>^{
    _show = YES;
}];
[(CALayer *)self.bgLayers[tapIndex] <span class="string">setBackgroundColor:</span>[UIColor <span class="string">colorWithWhite:</span><span class="number">0.9</span> <span class="string">alpha:</span><span class="number">1.0</span>].CGColor];
</code></pre><p>  }<br>}</p>
</li>
<li><p>(void)backgroundTapped:(UITapGestureRecognizer *)paramSender<br>{<br>  [self animateIdicator:_indicators[_currentSelectedMenudIndex] background:_backGroundView tableView:_tableView title:_titles[_currentSelectedMenudIndex] forward:NO complecte:^{</p>
<pre><code><span class="setting">_show = <span class="value"><span class="keyword">NO</span>;</span></span>
</code></pre><p>  }];<br>  [(CALayer *)self.bgLayers[_currentSelectedMenudIndex] setBackgroundColor:[UIColor whiteColor].CGColor];<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_animation_method">pragma mark - animation method</h1><ul>
<li><p>(void)animateIndicator:(CAShapeLayer *)indicator Forward:(BOOL)forward complete:(void(^)())complete {<br>  [CATransaction begin];<br>  [CATransaction setAnimationDuration:0.25];<br>  [CATransaction setAnimationTimingFunction:[CAMediaTimingFunction functionWithControlPoints:0.4 :0.0 :0.2 :1.0]];</p>
<p>  CAKeyframeAnimation *anim = [CAKeyframeAnimation animationWithKeyPath:@”transform.rotation”];<br>  //anim.values = forward ? @[ @0, @(M_PI) ] : @[ @(M_PI), @0 ];<br>  anim.values = forward ? @[ @0, @(M_PI_2) ] : @[ @(M_PI_2), @0 ];</p>
<p>  if (!anim.removedOnCompletion) {</p>
<pre><code>[indicator <span class="string">addAnimation:</span>anim <span class="string">forKey:</span>anim.keyPath];
</code></pre><p>  } else {</p>
<pre><code>[indicator <span class="string">addAnimation:</span>anim <span class="string">forKey:</span>anim.keyPath];
[indicator <span class="string">setValue:</span>anim.values.lastObject <span class="string">forKeyPath:</span>anim.keyPath];
</code></pre><p>  }</p>
<p>  [CATransaction commit];</p>
<p>  complete();<br>}</p>
</li>
</ul>
<p>//- (void)animateBackGroundView:(UIView *)view show:(BOOL)show complete:(void(^)())complete {<br>//    if (show) {<br>//        [self.superview addSubview:view];<br>//        [view.superview addSubview:self];<br>//<br>//        [UIView animateWithDuration:0.2 animations:^{<br>//            view.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];<br>//        }];<br>//    } else {<br>//        [UIView animateWithDuration:0.2 animations:^{<br>//            view.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.0];<br>//        } completion:^(BOOL finished) {<br>//            [view removeFromSuperview];<br>//        }];<br>//    }<br>//    complete();<br>//}</p>
<ul>
<li><p>(void)animateTableView:(UITableView *)tableView show:(BOOL)show positionX:(CGFloat)positionX  complete:(void(^)())complete {<br>  if (show) {</p>
<pre><code><span class="built_in">table</span>View.frame = CGRectMake(<span class="literal">self</span>.origin.x, <span class="literal">self</span>.frame.origin.y + <span class="literal">self</span>.frame.size.height, <span class="literal">self</span>.frame.size.width, <span class="number">0</span>);
[<span class="literal">self</span>.superview addSubview:<span class="built_in">table</span>View];

CGFloat <span class="built_in">table</span>ViewHeight = ([<span class="built_in">table</span>View numberOfRowsInSection:<span class="number">0</span>] &gt; <span class="number">5</span>) ? (<span class="number">5</span> * <span class="built_in">table</span>View.rowHeight) : ([<span class="built_in">table</span>View numberOfRowsInSection:<span class="number">0</span>] * <span class="built_in">table</span>View.rowHeight);

[UIView animateWithDuration:<span class="number">0.2</span> animations:^{
    _tableView.frame = CGRectMake(positionX, <span class="literal">self</span>.frame.origin.y + <span class="literal">self</span>.frame.size.height, <span class="literal">self</span>.frame.size.width/<span class="number">2</span>, <span class="built_in">table</span>ViewHeight);
}];
</code></pre><p>  } else {</p>
<pre><code><span class="collection">[UIView animateWithDuration:0.2 animations:<span class="comment">^{
    _tableView.frame = CGRectMake(positionX, self.frame.origin.y + self.frame.size.height, self.frame.size.width/2, 0);
}</span> completion:^<span class="list">(<span class="keyword">BOOL</span> finished)</span> <span class="collection">{
    <span class="collection">[tableView removeFromSuperview]</span><span class="comment">;</span>
}</span>]</span><span class="comment">;</span>
</code></pre><p>  }<br>  complete();<br>}</p>
</li>
<li><p>(void)animateTitle:(CATextLayer *)title show:(BOOL)show complete:(void(^)())complete {<br>  CGSize size = [self calculateTitleSizeWithString:title.string];<br>  CGFloat sizeWidth = (size.width &lt; (self.frame.size.width / _numOfMenu) - 25) ? size.width : self.frame.size.width / _numOfMenu - 25;<br>  title.bounds = CGRectMake(0, 0, sizeWidth, size.height);<br>  complete();<br>}</p>
</li>
<li><p>(void)animateIdicator:(CAShapeLayer <em>)indicator background:(UIView </em>)background tableView:(UITableView <em>)tableView title:(CATextLayer </em>)title forward:(BOOL)forward complecte:(void(^)())complete{</p>
<p>  [self animateIndicator:indicator Forward:forward complete:^{</p>
<pre><code>[self <span class="string">animateTitle:</span>title <span class="string">show:</span>forward <span class="string">complete:</span>^{
</code></pre><p>//           title.backgroundColor=[UIColor redColor].CGColor;<br>//            title.superlayer.backgroundColor=[UIColor greenColor].CGColor;<br>//            NSLog(@”%@”,title.position);<br>//            NSLog(@”%@”,title.bounds.size.width);</p>
<pre><code>  <span class="built_in">CGFloat</span> coloumWidth= <span class="keyword">self</span><span class="variable">.layer</span><span class="variable">.superlayer</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span>/<span class="keyword">self</span><span class="variable">.numOfMenu</span>;
    <span class="comment">//[self animateBackGroundView:background show:forward complete:^{</span>
        [<span class="keyword">self</span> animateTableView:tableView show:forward positionX:((<span class="built_in">NSInteger</span>)title<span class="variable">.position</span><span class="variable">.x</span>/(<span class="built_in">NSInteger</span>)coloumWidth)*coloumWidth complete:^{
        }];
    <span class="comment">//}];</span>
}];
</code></pre><p>  }];</p>
<p>  complete();<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_table_datasource">pragma mark - table datasource</h1><ul>
<li><p>(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {<br>  NSAssert(self.dataSource != nil, @”menu’s dataSource shouldn’t be nil”);<br>  if ([self.dataSource respondsToSelector:@selector(menu:numberOfRowsInColumn:)]) {</p>
<pre><code><span class="keyword">return</span> [<span class="keyword">self</span>.dataSource <span class="symbol">menu:</span><span class="keyword">self</span>
        <span class="symbol">numberOfRowsInColumn:</span><span class="keyword">self</span>.currentSelectedMenudIndex];
</code></pre><p>  } else {</p>
<pre><code><span class="built_in">NSAssert</span>(<span class="number">0</span> == <span class="number">1</span>, <span class="string">@"required method of dataSource protocol should be implemented"</span>);
<span class="keyword">return</span> <span class="number">0</span>;
</code></pre><p>  }<br>}</p>
</li>
<li><p>(UITableViewCell <em>)tableView:(UITableView </em>)tableView cellForRowAtIndexPath:(NSIndexPath <em>)indexPath<br>{<br>  static NSString </em>identifier = @”DropDownMenuCell”;<br>  UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:identifier];<br>  if (!cell) {</p>
<pre><code>cell = [[UITableViewCell alloc] <span class="string">initWithStyle:</span>UITableViewCellStyleDefault <span class="string">reuseIdentifier:</span>identifier];
</code></pre><p>  }<br>  NSAssert(self.dataSource != nil, @”menu’s datasource shouldn’t be nil”);<br>  if ([self.dataSource respondsToSelector:@selector(menu:titleForRowAtIndexPath:)]) {</p>
<pre><code>cell.textLabel.text = [self.dataSource <span class="string">menu:</span>self <span class="string">titleForRowAtIndexPath:</span>[DOPIndexPath <span class="string">indexPathWithCol:</span>self.currentSelectedMenudIndex <span class="string">row:</span>indexPath.row]];
</code></pre><p>  } else {</p>
<pre><code>NSAssert<span class="list">(<span class="number">0</span> == <span class="number">1</span>, @<span class="string">"dataSource method needs to be implemented"</span>)</span><span class="comment">;</span>
</code></pre><p>  }<br>  //UIView *lineView=[cell viewWithTag:100];<br>  //if (!lineView) {</p>
<pre><code><span class="built_in">UIView</span> *lineView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, _tableView<span class="variable">.rowHeight</span>-<span class="number">1</span>, cell<span class="variable">.contentView</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span>/<span class="number">2</span>, <span class="number">1</span>)];
<span class="comment">//lineView.tag=100;</span>
lineView<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> grayColor];
</code></pre><p> // }<br>  [cell.contentView addSubview:lineView];<br>  cell.backgroundColor = [UIColor whiteColor];<br>  cell.textLabel.font = [UIFont systemFontOfSize:14.0];<br>  cell.separatorInset = UIEdgeInsetsZero;</p>
<p>  if (cell.textLabel.text == [(CATextLayer *)[_titles objectAtIndex:_currentSelectedMenudIndex] string]) {</p>
<pre><code>cell.backgroundColor = [UIColor <span class="string">colorWithWhite:</span><span class="number">0.9</span> <span class="string">alpha:</span><span class="number">1.0</span>];
</code></pre><p>  }</p>
<p>  return cell;<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_tableview_delegate">pragma mark - tableview delegate</h1><ul>
<li><p>(void)tableView:(UITableView <em>)tableView didSelectRowAtIndexPath:(NSIndexPath </em>)indexPath {<br>  if (self.delegate || [self.delegate respondsToSelector:@selector(menu:didSelectRowAtIndexPath:)]) {</p>
<pre><code>[self <span class="string">confiMenuWithSelectRow:</span>indexPath.row];
[self.delegate <span class="string">menu:</span>self <span class="string">didSelectRowAtIndexPath:</span>[DOPIndexPath <span class="string">indexPathWithCol:</span>self.currentSelectedMenudIndex <span class="string">row:</span>indexPath.row]];
</code></pre><p>  } else {</p>
<pre><code>//<span class="type">TODO</span>: delegate <span class="keyword">is</span> <span class="keyword">nil</span>
</code></pre><p>  }<br>}</p>
</li>
<li><p>(void)confiMenuWithSelectRow:(NSInteger)row {<br>  CATextLayer <em>title = (CATextLayer </em>)_titles[_currentSelectedMenudIndex];<br>  title.string = [self.dataSource menu:self titleForRowAtIndexPath:[DOPIndexPath indexPathWithCol:self.currentSelectedMenudIndex row:row]];</p>
<p>  [self animateIdicator:_indicators[_currentSelectedMenudIndex] background:_backGroundView tableView:_tableView title:_titles[_currentSelectedMenudIndex] forward:NO complecte:^{</p>
<pre><code><span class="setting">_show = <span class="value"><span class="keyword">NO</span>;</span></span>
</code></pre><p>  }];<br>  [(CALayer *)self.bgLayers[_currentSelectedMenudIndex] setBackgroundColor:[UIColor whiteColor].CGColor];</p>
<p>  CAShapeLayer <em>indicator = (CAShapeLayer </em>)_indicators[_currentSelectedMenudIndex];<br>  indicator.position = CGPointMake(title.position.x + title.frame.size.width / 2 + 8, indicator.position.y);<br>}</p>
</li>
</ul>
<p>@end</p>
<h3 id="#">#</h3><p>@implementation DOPDropDownMenu</p>
<h1 id="pragma_mark_-_getter-1">pragma mark - getter</h1><ul>
<li><p>(UIColor *)indicatorColor<br>{<br>  if (!_indicatorColor) {</p>
<pre><code><span class="attribute">_indicatorColor </span>=<span class="string"> [UIColor blackColor];</span>
</code></pre><p>  }<br>  return _indicatorColor;<br>}</p>
</li>
<li><p>(UIColor *)textColor<br>{<br>  if (!_textColor) {</p>
<pre><code><span class="attribute">_textColor </span>=<span class="string"> [UIColor blackColor];</span>
</code></pre><p>  }<br>  return _textColor;<br>}</p>
</li>
<li><p>(UIColor *)separatorColor<br>{<br>  if (!_separatorColor) {</p>
<pre><code><span class="attribute">_separatorColor </span>=<span class="string"> [UIColor blackColor];</span>
</code></pre><p>  }<br>  return _separatorColor;<br>}</p>
</li>
<li><p>(NSString <em>)titleForRowAtIndexPath:(DOPIndexPath </em>)indexPath<br>{<br>  return [self.dataSource menu:self titleForRowAtIndexPath:indexPath];<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_setter-1">pragma mark - setter</h1><ul>
<li><p>(void)setDataSource:(id<dopdropdownmenudatasource>)dataSource<br>{<br>  _dataSource = dataSource;</dopdropdownmenudatasource></p>
<p>  //configure view<br>  if ([_dataSource respondsToSelector:@selector(numberOfColumnsInMenu:)]) {</p>
<pre><code><span class="constant">_numOfMenu </span>= [<span class="constant">_dataSource </span><span class="symbol">numberOfColumnsInMenu:</span><span class="keyword">self</span>];
</code></pre><p>  }<br>  else {</p>
<pre><code><span class="attribute">_numOfMenu </span>=<span class="string"> 1;</span>
</code></pre><p>  }</p>
<p>  CGFloat textLayerInterval = self.frame.size.width / (_numOfMenu * 2);<br>  CGFloat bgLayerInterval = self.frame.size.width / _numOfMenu;</p>
<p>  NSMutableArray <em>tempTitles = [[NSMutableArray alloc] initWithCapacity:_numOfMenu];<br>  NSMutableArray </em>tempIndicators = [[NSMutableArray alloc] initWithCapacity:_numOfMenu];<br>  NSMutableArray *tempBgLayers = [[NSMutableArray alloc] initWithCapacity:_numOfMenu];</p>
<p>  for (int i = 0; i &lt; _numOfMenu; i++) {</p>
<pre><code><span class="comment">//bgLayer</span>
<span class="built_in">CGPoint</span> bgLayerPosition = <span class="built_in">CGPointMake</span>((i + <span class="number">0.5</span>) * bgLayerInterval, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span> / <span class="number">2</span>);
<span class="built_in">CALayer</span> *bgLayer = [<span class="keyword">self</span> createBgLayerWithColor:[<span class="built_in">UIColor</span> whiteColor] andPosition:bgLayerPosition];
[<span class="keyword">self</span><span class="variable">.layer</span> addSublayer:bgLayer];
[tempBgLayers addObject:bgLayer];
<span class="comment">//title</span>
<span class="built_in">CGPoint</span> titlePosition = <span class="built_in">CGPointMake</span>((i * <span class="number">2</span> + <span class="number">1</span>) * textLayerInterval, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span> / <span class="number">2</span>);
<span class="built_in">NSString</span> *titleString = [_dataSource menu:<span class="keyword">self</span> titleForRowAtIndexPath:[DOPIndexPath indexPathWithCol:i row:<span class="number">0</span>]];
<span class="built_in">CATextLayer</span> *title = [<span class="keyword">self</span> createTextLayerWith<span class="built_in">NSString</span>:titleString withColor:<span class="keyword">self</span><span class="variable">.textColor</span> andPosition:titlePosition];
[<span class="keyword">self</span><span class="variable">.layer</span> addSublayer:title];
[tempTitles addObject:title];
<span class="comment">//indicator</span>
<span class="built_in">CAShapeLayer</span> *indicator = [<span class="keyword">self</span> createIndicatorWithColor:<span class="keyword">self</span><span class="variable">.indicatorColor</span> andPosition:<span class="built_in">CGPointMake</span>(titlePosition<span class="variable">.x</span> + title<span class="variable">.bounds</span><span class="variable">.size</span><span class="variable">.width</span> / <span class="number">2</span> + <span class="number">8</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span> / <span class="number">2</span>)];
[<span class="keyword">self</span><span class="variable">.layer</span> addSublayer:indicator];
[tempIndicators addObject:indicator];
</code></pre><p>  }<br>  _titles = [tempTitles copy];<br>  _indicators = [tempIndicators copy];<br>  _bgLayers = [tempBgLayers copy];<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_init_method-1">pragma mark - init method</h1><ul>
<li><p>(instancetype)initWithOrigin:(CGPoint)origin andHeight:(CGFloat)height<br>{<br>  CGSize screenSize = [UIScreen mainScreen].bounds.size;<br>  self = [self initWithFrame:CGRectMake(origin.x, origin.y, screenSize.width, height)];<br>  if (self) {</p>
<pre><code>_origin = origin;
_currentSelectedMenudIndex = -<span class="number">1</span>;
_show = <span class="literal">NO</span>;

<span class="comment">//tableView init</span>
_tableView = [[<span class="built_in">UITableView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(origin<span class="variable">.x</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.origin</span><span class="variable">.y</span> + <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span>, <span class="number">0</span>) style:<span class="built_in">UITableViewStylePlain</span>];
_tableView<span class="variable">.separatorStyle</span> = <span class="built_in">UITableViewCellSeparatorStyleNone</span>;
<span class="comment">//        _tableView.layer.borderWidth=1;</span>
<span class="comment">//        _tableView.layer.borderColor=[UIColor grayColor].CGColor;</span>
_tableView<span class="variable">.rowHeight</span> = <span class="number">38</span>;
_tableView<span class="variable">.dataSource</span> = <span class="keyword">self</span>;
_tableView<span class="variable">.delegate</span> = <span class="keyword">self</span>;

<span class="comment">//self tapped</span>
<span class="keyword">self</span><span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> whiteColor];
<span class="built_in">UIGestureRecognizer</span> *tapGesture = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(menuTapped:)];
[<span class="keyword">self</span> addGestureRecognizer:tapGesture];

<span class="comment">//background init and tapped</span>
_backGroundView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(origin<span class="variable">.x</span>, origin<span class="variable">.y</span>, screenSize<span class="variable">.width</span>, screenSize<span class="variable">.height</span>)];
_backGroundView<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> colorWithWhite:<span class="number">0.0</span> alpha:<span class="number">0.0</span>];
_backGroundView<span class="variable">.opaque</span> = <span class="literal">NO</span>;
<span class="built_in">UIGestureRecognizer</span> *gesture = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(backgroundTapped:)];
[_backGroundView addGestureRecognizer:gesture];

<span class="comment">//add bottom shadow</span>
<span class="built_in">UIView</span> *bottomShadow = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span> - <span class="number">0.5</span>, screenSize<span class="variable">.width</span>, <span class="number">0.5</span>)];
bottomShadow<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> lightGrayColor];
[<span class="keyword">self</span> addSubview:bottomShadow];
</code></pre><p>  }<br>  return self;<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_init_support-1">pragma mark - init support</h1><ul>
<li><p>(CALayer <em>)createBgLayerWithColor:(UIColor </em>)color andPosition:(CGPoint)position<br>{<br>  CALayer *layer = [CALayer layer];<br>  layer.position = position;<br>  layer.bounds = CGRectMake(0, 0, self.frame.size.width / self.numOfMenu, self.frame.size.height - 1);<br>  layer.backgroundColor = color.CGColor;<br>  //    NSLog(@”bglayer bounds:%@”,NSStringFromCGRect(layer.bounds));<br>  //    NSLog(@”bglayer position:%@”, NSStringFromCGPoint(position));</p>
<p>  return layer;<br>}</p>
</li>
<li><p>(CAShapeLayer <em>)createIndicatorWithColor:(UIColor </em>)color andPosition:(CGPoint)point<br>{<br>  UIImage <em>backgroundImage = [UIImage imageNamed:@”my”];<br>  CAShapeLayer </em>layer = [CAShapeLayer new];<br>  CGFloat nativeWidth = CGImageGetWidth(backgroundImage.CGImage);<br>  CGFloat nativeHeight = CGImageGetHeight(backgroundImage.CGImage);<br>  CGRect startFrame = CGRectMake(0.0, 0.0, nativeWidth, nativeHeight);<br>  layer.contents = (id)backgroundImage.CGImage;<br>  layer.frame = startFrame;<br>  layer.position = point;<br>  return layer;<br>}</p>
</li>
<li><p>(CATextLayer <em>)createTextLayerWithNSString:(NSString </em>)string withColor:(UIColor *)color andPosition:(CGPoint)point<br>{</p>
<p>  CGSize size = [self calculateTitleSizeWithString:string];</p>
<p>  CATextLayer *layer = [CATextLayer new];<br>  CGFloat sizeWidth = (size.width &lt; (self.frame.size.width / _numOfMenu) - 25) ? size.width : self.frame.size.width / _numOfMenu - 25;<br>  layer.bounds = CGRectMake(0, 0, sizeWidth, size.height);<br>  layer.string = string;<br>  layer.fontSize = 14.0;<br>  layer.alignmentMode = kCAAlignmentCenter;<br>  layer.foregroundColor = color.CGColor;</p>
<p>  layer.contentsScale = [[UIScreen mainScreen] scale];</p>
<p>  layer.position = point;</p>
<p>  return layer;<br>}</p>
</li>
<li><p>(CGSize)calculateTitleSizeWithString:(NSString <em>)string<br>{<br>  CGFloat fontSize = 14.0;<br>  NSDictionary </em>dic = @{NSFontAttributeName : [UIFont systemFontOfSize:fontSize]};<br>  CGSize size = [string boundingRectWithSize:CGSizeMake(280, 0) options:NSStringDrawingTruncatesLastVisibleLine | NSStringDrawingUsesLineFragmentOrigin | NSStringDrawingUsesFontLeading attributes:dic context:nil].size;<br>  return size;<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_gesture_handle-1">pragma mark - gesture handle</h1><ul>
<li><p>(void)menuTapped:(UITapGestureRecognizer *)paramSender<br>{<br>  CGPoint touchPoint = [paramSender locationInView:self];<br>  //calculate index<br>  NSInteger tapIndex = touchPoint.x / (self.frame.size.width / _numOfMenu);</p>
<p>  for (int i = 0; i &lt; _numOfMenu; i++) {</p>
<pre><code><span class="tag">if</span> (i != tapIndex) {
    <span class="attr_selector">[self animateIndicator:_indicators[i]</span>
                   <span class="tag">Forward</span><span class="pseudo">:NO</span>
                  <span class="tag">complete</span>:^{
                    <span class="attr_selector">[self animateTitle:_titles[i]</span>
                                  <span class="tag">show</span><span class="pseudo">:NO</span>
                              <span class="tag">complete</span>:^{

                              }];
                  }];
    <span class="attr_selector">[(CALayer *)self.bgLayers[i]</span> <span class="tag">setBackgroundColor</span>:<span class="attr_selector">[UIColor whiteColor]</span><span class="class">.CGColor</span>];
}
</code></pre><p>  }</p>
<p>  if (tapIndex == _currentSelectedMenudIndex &amp;&amp; _show) {</p>
<pre><code><span class="collection">[self animateIdicator:_indicators<span class="collection">[_currentSelectedMenudIndex]</span>
           background:_backGroundView
            tableView:_tableView
                title:_titles<span class="collection">[_currentSelectedMenudIndex]</span>
              forward:NO
            complecte:<span class="comment">^{
              _currentSelectedMenudIndex = tapIndex;
              _show = NO;
            }</span>]</span><span class="comment">;</span>
<span class="collection">[<span class="list">(<span class="keyword">CALayer</span> *)</span>self.bgLayers<span class="collection">[tapIndex]</span> setBackgroundColor:<span class="collection">[UIColor whiteColor]</span>.CGColor]</span><span class="comment">;</span>
</code></pre><p>  }<br>  else {</p>
<pre><code><span class="name">_currentSelectedMenudIndex</span> = <span class="atom">tapIndex</span>;
[<span class="name">_tableView</span> <span class="atom">reloadData</span>];
[<span class="atom">self</span> <span class="atom">animateIdicator</span>:<span class="name">_indicators</span>[<span class="atom">tapIndex</span>]
           <span class="atom">background</span>:<span class="name">_backGroundView</span>
            <span class="atom">tableView</span>:<span class="name">_tableView</span>
                <span class="atom">title</span>:<span class="name">_titles</span>[<span class="atom">tapIndex</span>]
              <span class="atom">forward</span>:<span class="name">YES</span>
            <span class="atom">complecte</span>:^{
              <span class="name">_show</span> = <span class="name">YES</span>;
            }];
[(<span class="name">CALayer</span> *)<span class="atom">self</span>.<span class="atom">bgLayers</span>[<span class="atom">tapIndex</span>] <span class="atom">setBackgroundColor</span>:[<span class="name">UIColor</span> <span class="atom">colorWithWhite</span>:<span class="number">0.9</span> <span class="atom">alpha</span>:<span class="number">1.0</span>].<span class="name">CGColor</span>];
</code></pre><p>  }<br>}</p>
</li>
<li><p>(void)backgroundTapped:(UITapGestureRecognizer *)paramSender<br>{<br>  [self animateIdicator:_indicators[_currentSelectedMenudIndex]</p>
<pre><code><span class="rule"><span class="attribute">background</span>:<span class="value">_backGroundView
 tableView:_tableView
     title:_titles[_currentSelectedMenudIndex]
   forward:NO
 complecte:^{
   _show = NO</span></span>;
 }];
</code></pre><p>  [(CALayer *)self.bgLayers[_currentSelectedMenudIndex] setBackgroundColor:[UIColor whiteColor].CGColor];<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_animation_method-1">pragma mark - animation method</h1><ul>
<li><p>(void)animateIndicator:(CAShapeLayer *)indicator Forward:(BOOL)forward complete:(void (^)())complete<br>{<br>  [CATransaction begin];<br>  [CATransaction setAnimationDuration:0.25];<br>  [CATransaction setAnimationTimingFunction:[CAMediaTimingFunction functionWithControlPoints:0.4:0.0:0.2:1.0]];</p>
<p>  CAKeyframeAnimation *anim = [CAKeyframeAnimation animationWithKeyPath:@”transform.rotation”];<br>  //anim.values = forward ? @[ @0, @(M_PI) ] : @[ @(M_PI), @0 ];<br>  anim.values = forward ? @[ @0, @(M_PI_2) ] : @[ @(M_PI_2), @0 ];</p>
<p>  if (!anim.removedOnCompletion) {</p>
<pre><code>[indicator <span class="string">addAnimation:</span>anim <span class="string">forKey:</span>anim.keyPath];
</code></pre><p>  }<br>  else {</p>
<pre><code>[indicator <span class="string">addAnimation:</span>anim <span class="string">forKey:</span>anim.keyPath];
[indicator <span class="string">setValue:</span>anim.values.lastObject <span class="string">forKeyPath:</span>anim.keyPath];
</code></pre><p>  }</p>
<p>  [CATransaction commit];</p>
<p>  complete();<br>}</p>
</li>
</ul>
<p>//- (void)animateBackGroundView:(UIView *)view show:(BOOL)show complete:(void(^)())complete {<br>//    if (show) {<br>//        [self.superview addSubview:view];<br>//        [view.superview addSubview:self];<br>//<br>//        [UIView animateWithDuration:0.2 animations:^{<br>//            view.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];<br>//        }];<br>//    } else {<br>//        [UIView animateWithDuration:0.2 animations:^{<br>//            view.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.0];<br>//        } completion:^(BOOL finished) {<br>//            [view removeFromSuperview];<br>//        }];<br>//    }<br>//    complete();<br>//}</p>
<ul>
<li><p>(void)animateTableView:(UITableView *)tableView show:(BOOL)show positionX:(CGFloat)positionX complete:(void (^)())complete<br>{<br>  if (show) {</p>
<pre><code><span class="built_in">table</span>View.frame = CGRectMake(<span class="literal">self</span>.origin.x, <span class="literal">self</span>.frame.origin.y + <span class="literal">self</span>.frame.size.height, <span class="literal">self</span>.frame.size.width, <span class="number">0</span>);
[<span class="literal">self</span>.superview addSubview:<span class="built_in">table</span>View];

CGFloat <span class="built_in">table</span>ViewHeight = ([<span class="built_in">table</span>View numberOfRowsInSection:<span class="number">0</span>] &gt; <span class="number">5</span>) ? (<span class="number">5</span> * <span class="built_in">table</span>View.rowHeight) : ([<span class="built_in">table</span>View numberOfRowsInSection:<span class="number">0</span>] * <span class="built_in">table</span>View.rowHeight);

[UIView animateWithDuration:<span class="number">0.2</span>
                 animations:^{
                   _tableView.frame = CGRectMake(positionX, <span class="literal">self</span>.frame.origin.y + <span class="literal">self</span>.frame.size.height, <span class="literal">self</span>.frame.size.width / <span class="number">2</span>, <span class="built_in">table</span>ViewHeight);
                 }];
</code></pre><p>  }<br>  else {</p>
<pre><code><span class="collection">[UIView animateWithDuration:0.2
    animations:<span class="comment">^{
      _tableView.frame = CGRectMake(positionX, self.frame.origin.y + self.frame.size.height, self.frame.size.width / 2, 0);
    }</span>
    completion:^<span class="list">(<span class="keyword">BOOL</span> finished)</span> <span class="collection">{
      <span class="collection">[tableView removeFromSuperview]</span><span class="comment">;</span>
    }</span>]</span><span class="comment">;</span>
</code></pre><p>  }<br>  complete();<br>}</p>
</li>
<li><p>(void)animateTitle:(CATextLayer *)title show:(BOOL)show complete:(void (^)())complete<br>{<br>  CGSize size = [self calculateTitleSizeWithString:title.string];<br>  CGFloat sizeWidth = (size.width &lt; (self.frame.size.width / _numOfMenu) - 25) ? size.width : self.frame.size.width / _numOfMenu - 25;<br>  title.bounds = CGRectMake(0, 0, sizeWidth, size.height);<br>  complete();<br>}</p>
</li>
<li><p>(void)animateIdicator:(CAShapeLayer <em>)indicator background:(UIView </em>)background tableView:(UITableView <em>)tableView title:(CATextLayer </em>)title forward:(BOOL)forward complecte:(void (^)())complete<br>{</p>
<p>  [self animateIndicator:indicator</p>
<pre><code> Forward:forward
complete:^{
  [<span class="keyword">self</span> animateTitle:title
                show:forward
            complete:^{
              <span class="built_in">CGFloat</span> coloumWidth = <span class="keyword">self</span><span class="variable">.layer</span><span class="variable">.superlayer</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span> / <span class="keyword">self</span><span class="variable">.numOfMenu</span>;
              [<span class="keyword">self</span> animateTableView:tableView
                                show:forward
                           positionX:((<span class="built_in">NSInteger</span>)title<span class="variable">.position</span><span class="variable">.x</span> / (<span class="built_in">NSInteger</span>)coloumWidth) * coloumWidth
                            complete:^{
                            }];
            }];
}];
</code></pre><p>  complete();<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_table_datasource-1">pragma mark - table datasource</h1><ul>
<li><p>(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section<br>{<br>  NSAssert(self.dataSource != nil, @”menu’s dataSource shouldn’t be nil”);<br>  if ([self.dataSource respondsToSelector:@selector(menu:numberOfRowsInColumn:)]) {</p>
<pre><code><span class="keyword">return</span> [<span class="keyword">self</span>.dataSource <span class="symbol">menu:</span><span class="keyword">self</span>
        <span class="symbol">numberOfRowsInColumn:</span><span class="keyword">self</span>.currentSelectedMenudIndex];
</code></pre><p>  }<br>  else {</p>
<pre><code><span class="built_in">NSAssert</span>(<span class="number">0</span> == <span class="number">1</span>, <span class="string">@"required method of dataSource protocol should be implemented"</span>);
<span class="keyword">return</span> <span class="number">0</span>;
</code></pre><p>  }<br>}</p>
</li>
<li><p>(UITableViewCell <em>)tableView:(UITableView </em>)tableView cellForRowAtIndexPath:(NSIndexPath <em>)indexPath<br>{<br>  static NSString </em>identifier = @”DropDownMenuCell”;<br>  UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:identifier];<br>  if (!cell) {</p>
<pre><code>cell = [[UITableViewCell alloc] <span class="string">initWithStyle:</span>UITableViewCellStyleDefault <span class="string">reuseIdentifier:</span>identifier];
</code></pre><p>  }<br>  NSAssert(self.dataSource != nil, @”menu’s datasource shouldn’t be nil”);<br>  if ([self.dataSource respondsToSelector:@selector(menu:titleForRowAtIndexPath:)]) {</p>
<pre><code>cell.textLabel.text = [self.dataSource <span class="string">menu:</span>self <span class="string">titleForRowAtIndexPath:</span>[DOPIndexPath <span class="string">indexPathWithCol:</span>self.currentSelectedMenudIndex <span class="string">row:</span>indexPath.row]];
</code></pre><p>  }<br>  else {</p>
<pre><code>NSAssert<span class="list">(<span class="number">0</span> == <span class="number">1</span>, @<span class="string">"dataSource method needs to be implemented"</span>)</span><span class="comment">;</span>
</code></pre><p>  }</p>
<p>  UIView *lineView = [[UIView alloc] initWithFrame:CGRectMake(0, _tableView.rowHeight - 1, cell.contentView.frame.size.width / 2, 1)];<br>  lineView.backgroundColor = [UIColor grayColor];<br>  [cell.contentView addSubview:lineView];<br>  cell.backgroundColor = [UIColor whiteColor];<br>  cell.textLabel.font = [UIFont systemFontOfSize:14.0];<br>  cell.textLabel.textAlignment = NSTextAlignmentCenter;<br>  cell.separatorInset = UIEdgeInsetsZero;</p>
<p>  if (cell.textLabel.text == [(CATextLayer *)[_titles objectAtIndex:_currentSelectedMenudIndex] string]) {</p>
<pre><code>cell.backgroundColor = [UIColor <span class="string">colorWithWhite:</span><span class="number">0.9</span> <span class="string">alpha:</span><span class="number">1.0</span>];
</code></pre><p>  }</p>
<p>  return cell;<br>}</p>
</li>
</ul>
<h1 id="pragma_mark_-_tableview_delegate-1">pragma mark - tableview delegate</h1><ul>
<li><p>(void)tableView:(UITableView <em>)tableView didSelectRowAtIndexPath:(NSIndexPath </em>)indexPath<br>{<br>  if (self.delegate || [self.delegate respondsToSelector:@selector(menu:didSelectRowAtIndexPath:)]) {</p>
<pre><code>[self <span class="string">confiMenuWithSelectRow:</span>indexPath.row];
[self.delegate <span class="string">menu:</span>self <span class="string">didSelectRowAtIndexPath:</span>[DOPIndexPath <span class="string">indexPathWithCol:</span>self.currentSelectedMenudIndex <span class="string">row:</span>indexPath.row]];
</code></pre><p>  }<br>  else {</p>
<pre><code>//<span class="type">TODO</span>: delegate <span class="keyword">is</span> <span class="keyword">nil</span>
</code></pre><p>  }<br>}</p>
</li>
<li><p>(void)confiMenuWithSelectRow:(NSInteger)row<br>{<br>  CATextLayer <em>title = (CATextLayer </em>)_titles[_currentSelectedMenudIndex];<br>  title.string = [self.dataSource menu:self titleForRowAtIndexPath:[DOPIndexPath indexPathWithCol:self.currentSelectedMenudIndex row:row]];</p>
<p>  [self animateIdicator:_indicators[_currentSelectedMenudIndex]</p>
<pre><code><span class="rule"><span class="attribute">background</span>:<span class="value">_backGroundView
 tableView:_tableView
     title:_titles[_currentSelectedMenudIndex]
   forward:NO
 complecte:^{
   _show = NO</span></span>;
 }];
</code></pre><p>  [(CALayer *)self.bgLayers[_currentSelectedMenudIndex] setBackgroundColor:[UIColor whiteColor].CGColor];</p>
<p>  CAShapeLayer <em>indicator = (CAShapeLayer </em>)_indicators[_currentSelectedMenudIndex];<br>  indicator.position = CGPointMake(title.position.x + title.frame.size.width / 2 + 8, indicator.position.y);<br>}</p>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-mac操作系统" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/15/mac操作系统/" class="article-date">
  	<time datetime="2015-07-15T07:49:58.000Z" itemprop="datePublished">7月 15 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Mac操作系统">Mac操作系统</h3><ol>
<li>10.4.4 tiger开始入侵intel x86的地盘   ppc架构 x86架构</li>
<li>iOS内核和二进制编译的目标架构是arm架构，电源管理有优势</li>
<li>unix api darwin</li>
<li>按下空格键快速预览</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-禅与OC" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/15/禅与OC/" class="article-date">
  	<time datetime="2015-07-15T02:35:41.000Z" itemprop="datePublished">7月 15 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="问题">问题</h2><ol>
<li>常量应该尽量使用 in-line 的字符串字面值或者数字，这样便于经常用到的时候复用</li>
<li>extern NSString *const ZOCCacheControllerDidClearCacheNotification;关键字的作用</li>
<li>如果 block 没有在其他地方被保持，那么它会随着栈生存并且当栈帧（stack frame）返回的时候消失。当在栈上的时候，一个 block 对访问的任何内容不会有影响。如果 block 需要在<strong>栈帧返回</strong>的时候存在，它们需要明确地被复制到堆上，这样，block 会像其他 Cocoa 对象一样增加引用计数。</li>
<li>如果一个 block指向一个栈变量或者指针，那么这个block初始化的时候它会有一份声明为 const 的副本，所以对它们赋值是没用的</li>
<li>复制之后栈上的以及产生的堆上的 block 都会引用这个堆上的变量。引用计数器为</li>
<li></li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-熟悉objective-c" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/14/熟悉objective-c/" class="article-date">
  	<time datetime="2015-07-14T07:48:05.000Z" itemprop="datePublished">7月 14 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="熟悉Objective-C">熟悉Objective-C</h2><p>使用消息结构的语言，运行时所执行的代码由运行环境决定，而使用函数调用的语言，由编译器决定。<br>尽量减少引入头文件<br>@class只能告诉你有个这个类，不能告诉你类里面有什么</p>
<p>字面量数组比按常规创建的数组的语法要安全，遇到nil会报错，但是如果用常规方法的话，如果1，3有值，第二个元素为Nil，那么创建出来的数组元素只有第一个元素，会<strong>丢失数据</strong></p>
<p><strong>字面量字典</strong><br>字符串，数组，字典对象都是不可变的，但是要可变就要复制一份<br><strong>多用类型常量，少用#define</strong><br>define没有类型，重复定义不会报错<br>如果文件局限于.m文件，则在常量前面加K，在类之外也可看到就加前缀<br>常量名称，为了避免命名冲突，所以加上类型作为前缀</p>
<h3 id="属性">属性</h3><p>属性用于封装数据<br>语义：copy<br>在对象内部读取数据时，应该直接通过实例变量来读，写入数据时，通过属性来</p>
<h3 id="实例变量">实例变量</h3><ol>
<li>声明 @interface MainController {<br>  ASIHTTPRequest *request;<br>}</li>
</ol>
<h3 id="理解objec_msgSend">理解objec_msgSend</h3><ol>
<li>步骤：[someObject messageName:parameter]=void objec_msgSend(id self,sel cmd,…)  在方法列表中找，如果能找到，就执行，如果不能找到就往上找，最终找不到，就调用messaggeForWarding</li>
<li>缓存（fast map）每个类都有这样一块缓存</li>
<li>objc_msgSend_stret,objec_msgSend_fpret</li>
<li>消息转发过程<code>reolveInstanceMethod-&gt;forwardingTargetForSelector(备援)-&gt;forwardInvocation</code><h3 id="方法混写">方法混写</h3>每个方法对于相对的实现，我们可以交换方法的实现<br>方法混写滥用会造成代码不易懂和难以维护<h3 id="类对象">类对象</h3>消息的接受者究竟是神马？<br>oc对象实例是指向某块内存的指针，变量会指向该实例<br>kind代表一种（有继承），member代表成员<br>类对象是单例<h3 id="实现description">实现description</h3></li>
</ol>
<h3 id="理解NSCopying">理解NSCopying</h3><h3 id="prorocol：声明一些方法，相当于接口（代理模式，观察者模式）">prorocol：声明一些方法，相当于接口（代理模式，观察者模式）</h3><ol>
<li>&lt;&gt;遵守协议，：实现继承 ()分类   {}字典 （）可以是数组</li>
<li>基协议：类似继承，基类会遵守基协</li>
<li>要求对象遵守自定义协议，NSObject<myprotocol></myprotocol></li>
<li>属性必须遵守某个协议  id<myprotocol> obj,成为属性也要遵守协议</myprotocol></li>
</ol>
<h3 id="分类">分类</h3><p>@interface Person(Add)</p>
<p>提供类方法快捷访问<br>分类会覆盖原类的方法：</p>
<h3 id="NSMutableString">NSMutableString</h3><ol>
<li>继承NSString 可变字符串可以在字符串对象的内容  增加和删除，删除是从零开始的</li>
<li>rangeOfString,获取在字符串的位置（删除固定的字符串）</li>
<li>NSArray(集合类),ocs数组只能存放oc对象，不能存放非OC对象，nil是数组元素结束的标记，编译器特性@[]</li>
<li>NSSet:没有顺序的</li>
<li>关键字以@开头</li>
<li>先把类加载到内存</li>
<li><em>str str代表内存空间地址  </em>str代表找到对应的存储空间  &amp;str是str的地址  **str代表地址<h3 id="裁剪">裁剪</h3></li>
<li>MasksToBounds(clipToBounds):方法告诉layer将位于它之下的layer都<strong>遮盖住</strong></li>
<li>views是独立的，内部细节是不需要让控制器知道的</li>
</ol>
<h3 id="UIContentMode中的fill和_fit_aspect">UIContentMode中的fill和 fit  aspect</h3><ol>
<li>fill相当于是横屏(相当于去横屏进行缩放)； //房间里很快挤满了人 （横向的）</li>
<li>fit相当于是竖屏(相当于去竖屏进行缩放)；  //That jacket fits well. 衣服是一个竖向的东西</li>
<li>aspect是等比,ASPECT RATIO 画面比例影像放映在银幕上的纵横（高宽）比例。</li>
<li>记录代码的运行时间<code>#define TICK   NSDate *startTime = [NSDate date] #define TOCK   NSLog(@&quot;Time: %f&quot;, -[startTime timeIntervalSinceNow])</code></li>
<li>Antialia  self.layer.allowsEdgeAntialiasing = YES;//反锯齿</li>
<li>修复xcode 插件失效<br>find ~/Library/Application\ Support/Developer/Shared/Xcode/Plug-ins -name Info.plist -maxdepth 3 | xargs -I{} defaults write {} DVTPlugInCompatibilityUUIDs -array-add `defaults read /Applications/Xcode.app/Contents/Info.plist DVTPlugInCompatibilityUUID</li>
<li><a href="http://qiufeng.me/xcode-format%20copy/" target="_blank" rel="external">clangformat 插件修改</a> 重命名vm 改名字为系统禁止改的形式，要用终端</li>
</ol>
<h3 id="nil和NULL">nil和NULL</h3><ol>
<li>NSURL <em>url = nil；<br>Class class = Nil；<br>int </em>pointerInt = NULL；<br>nil是一个对象指针为空，Nil是一个类指针为空，NULL是基本数据类型为空。<h3 id="Unsafe_unretained_=_assgin">Unsafe_unretained = assgin</h3></li>
<li>对应基本数据类型<h3 id="copy">copy</h3></li>
<li>当某个属性是指向其他对象的指针，而且改对象的类有可修改的子类，应该设置为copy(只有可变对象才要用Coopy)  <a href="http://v.youku.com/v_show/id_XOTMwMjcwNTgw.html?f=23636745&amp;from=y1.2-3.4.17" target="_blank" rel="external">视频</a></li>
<li>copy <strong>语法是创建一个副本，改变对象不影响原来的对象</strong>  string array dictionary copy产生的都是不可变   mutableCopy产生的都是可变</li>
<li>调用string copy 并没有产生一个新的对象 在这里copy就相当于retian  ,不可变变成不可变才是浅拷贝，其余都是深度拷贝   Mutable对象 MutableCopy都是深拷贝</li>
<li><p>`  NSString *str=@”111”;<br>p.name=str;</p>
<p>str=@”222”;<br>NSLog(@”%@”,p.name); ///111<br>NSLog(@”%@”,str); ///222`</p>
<h3 id="自动释放池">自动释放池</h3></li>
<li>不使用alloc init创建的对象，一般放在自动释放池里管理</li>
<li>在没有手加Autorelease Pool的情况下，Autorelease对象是在当前的runloop迭代结束时释放的，而它能够释放的原因是系统在每个runloop迭代中都加入了自动释放池Push和Pop</li>
<li>AutoreleasePoolPage</li>
<li>AutoreleasePoolPage每个对象会开辟4096字节内存（也就是虚拟内存一页的大小）</li>
<li>释放是由高向低进行释放，所以Autorelease Pool嵌套，不会有影响</li>
</ol>
<h4 id="uiimage和imageWithContentsOfFile">uiimage和imageWithContentsOfFile</h4><ol>
<li><1>+imageNamed：该方法使用系统缓存，适合表视图重复加载图像的情形。同时该API根据UIScreen的scale，自动查找包含对应高倍图后缀名（@2x）的文件，如果没找到设置默认image.scale=1.0。因此，使用该方法，无需特意指定高倍图后缀。在实际运行时，系统如果发现当前设备是Retina屏（scale=2），会自动寻找”*@2x.png”命名格式的图片，加载针对Retina屏的图片素材，否则会失真。<ol>
<li><2>+imageWithContentsOfFile/+imageWithData:(scale:)/-initWithContentsOfFile:/-initWithData:(scale:)<br>这组方法创建的UIImage对象没有使用系统缓存，并且指定文件名必须包含明确的高倍图后缀。如果文件名包含@2x后缀，则image.scale=2.0；否则默认image.scale=1.0，同样对于Retina屏将会失真。</2></li>
</ol>
</1></li>
</ol>
<h4 id="loadView/viewDidLoad/initWithNibName/awakeFromNib/initWithCoder的用法">loadView/viewDidLoad/initWithNibName/awakeFromNib/initWithCoder的用法</h4><p>大前提是UIViewController有一个UIView.同时,需要厘清两个概念,创建一个类和实例化一个类.在XCode中创建一个类和实例化一个类很容易区分,但是在IB(Interface Builder)中有时候就会迷糊.其实也很好区分,孤零零地创建了一个nib文件,没有和其他可被实例化的类有直接或间接关系的时候,这个类或这些类(一个nib文件俺也可能包含多个类)是没有机会被实例化的,所以这种情况只是通过ib创建了一个类,而没有实例化.真正的实例化还需要通过在Xcode用代码来读取这个nib文件.知道这两这的区别后这些方法也就容易辨认多了 </p>
<p>viewDidLoad其实没什么可混淆的,无论通过什么途径加载(Xcode或者IB,这里的加载属于实例化)完view后肯定会执行这个方法. </p>
<p>loadView需要分两种情况.当你通过Xcode实例化一个类的时候就需要自己在controller中实现这个方法.而在IB中实例化就不需要实现它. </p>
<p>initWithNibName这个方法是在controller的类在IB中创建,但是通过Xcode实例化controller的时候用的. </p>
<p>awakeFromNib这个方法是一个类在IB中被实例化是被调用的.看了帖子发现大家都推荐使用viewDidLoad而不要使用awakeFromNib,应为viewDidLoad会被多次调用,而awakeFromNib只会当从nib文件中unarchive的时候才会被调用一次.实际测试中发现,<strong>当一个类的awakeFromNib被调用的时候,那么这个类的viewDidLoad就不会被调用了</strong>,这个感觉很奇怪. </p>
<p>initWithCoder是一个类在IB中创建但在xocdde中被实例化时被调用的.比如,通过IB创建一个controller的nib文件,然后在xocde中通过initWithNibName来实例化这个controller,那么这个controller的initWithCoder会被调用. </p>
<p>如果你的对象是UIViewControler的子类，那么你<strong>必须调用</strong>- (id)initWithNibName:(NSString <em>)nibNameOrNil bundle:(NSBundle</em>)nibBundleOrNil;方法去调用NIB文件初始化自身，即使那没有使用nib文件也会调用这个函数（默认情况下init方法已经为你的做这件事情了），如果你调用这个方法，并传递的两个参数为空（nil），然后类会调用-loadView去读取一个名字和你的UIViewController名字相同的nib文件，来初始化自身。如果没有这样的nib文件，你必须调用-setView:来设置一个self.view。或者重载-loadView 方法 </p>
<p>（2）<strong>initWithCoder: &amp; initWithFrame:</strong><br>initWithCoder：使用文件加载的对象调用（如从xib或stroyboard中创建）<br>initWithFrame：使用代码加载的对象调用（使用纯代码创建） <strong>init会调用这个函数</strong><br>注意：所以为了同时兼顾从文件和从代码解析的对象初始化，要同时在initWithCoder: 和 initWithFrame: 中进行初始化</p>
<p>viewDidLoad,就是view加载完毕之后就会调用，无论手写还是xib</p>
<p>initwithNibName-&gt;loadView(只负责从XIB中加载，但是如果你重写这个就可以用你自己的代码)-&gt; viewDidLoad 这个顺序</p>
<p>initWithNibName:<strong>半代码化初始</strong>时使用. 完全IB化初始时不调用,UIViewController代码化初始时会通过init调用,<strong>且调用在[super init]中</strong>.（这是为什么要调用Super init 的原因之一）<br>调用顺序: super init-&gt;initWithNibName(其实在super init中) -&gt;init after self created-&gt;loadView-&gt;ViewDidLoad</p>
<p>在遍历的时候，使用<strong>strong修改正在遍历的值<br>Fast enumeration variables can’t be modified in ARC by default; declare the variable </strong>strong to allow this<br>Rationale<br>This is an optimization made possible because fast enumeration loops promise to keep the objects retained during enumeration, and the collection itself cannot be synchronously modified. It can be overridden by explicitly qualifying the variable with __strong, which will make the variable mutable again and cause the loop to retain the objects it encounters.</p>
<h4 id="clipsToBounds和masksToBounds">clipsToBounds和masksToBounds</h4><h4 id="_deleteButton-currentImage-size-width">_deleteButton.currentImage.size.width</h4><h4 id="layoutSubviews">layoutSubviews</h4><p>在5.1之前什么都不做，除此之外<br>the default implementation uses any constraints you have set to determine the size and position of any subviews.</p>
<p>而且，layoutSubviews 方法只能被系统触发调用，程序员不能手动直接调用该方法</p>
<p>Stackoverflow 上已经有相关的讨论了（作者在他的博客上有更详细的描述），并且有一位朋友给出了很不错的解答：</p>
<p>init does not cause layoutSubviews to be called (duh)<br>addSubview causes layoutSubviews to be called on the view being added, the view it’s being added to (target view), and all the subviews of the target<br>view setFrame intelligently calls layoutSubviews on the view having its frame set only if the size parameter of the frame is different<br>scrolling a UIScrollView causes layoutSubviews to be called on the scrollView, and its superview<br>rotating a device only calls layoutSubview on the parent view (the responding viewControllers primary view)<br>Resizing a view will call layoutSubviews on its superview<br>也就是说，layoutSubviews 方法会在这些情况下，在这些 UIView 实例上被调用：</p>
<ol>
<li>addSubview 被调用时：target view（一定会），以及被添加的 view（第一次调用会）</li>
<li>更改 UIView 的 frame 时：被更改 frame 的 view（frame 与之前不同时）</li>
<li>对于 UIScrollView 而言，滚动式：scroll view</li>
<li>设备的 orientation 改变时：涉及改变的 UIViewController 的 root view</li>
<li>使用 CGAffineTransformScale 改变 view 的 transform 属性时，view 的 superview：被改变的 view<br>总结：</li>
<li>第一次调用 addSubview 的时候，target view 和被添加到 target view 的 view 的 layoutSubviews 方法会被调用。在已经添加完毕后，若 target view 已经拥有该被添加 view，则只有 target view 的 layoutSubviews 方法会被调用。“and all the subviews of the target”这句话是错误的。</li>
<li>只有 UIView 处于 key window 的 UIView 树中时，该 UIView 的 layoutSubviews 方法才有可能被调用。不在树中的不会被调用。这也是为什么 Stackoverflow 上的讨论中这个答案的第二点会被提出。</li>
</ol>
<p>能做的三件事<br>Adjust the size and position of any immediate subviews.<br>Add or remove subviews or Core Animation layers.<br>Force a subview to be redrawn by calling its setNeedsDisplay or setNeedsDisplayInRect: method.<br>//应用程序经常重新布局子视图，当使用一个大的ScrollView<br>发生滚动事件，根视图 setNeedsLayout-&gt;setNeedsLayout重新布局，当视图片滚出可视范围，layoutSubView 移动新的视图到进入的边缘，替换掉原来的视图<br>layoutSubView方法</p>
<h4 id="Composite_Pattern">Composite Pattern</h4><h4 id="__bridge">__bridge</h4><p>还可以通过 __bridge 转换让局部变量持有返回对象</p>
<h4 id="你必须有一个类的源码才能为一个类添加extension，所以你无法为系统的类比如NSString添加extension。">你必须有一个类的源码才能为一个类添加extension，所以你无法为系统的类比如NSString添加extension。</h4><p>因为在运行期，对象的内存布局已经确定，如果添加实例变量就会破坏类的内部布局，这对编译型语言来说是灾难性的</p>
<p><a href="http://tech.meituan.com/DiveIntoCategory.html" target="_blank" rel="external">分类</a></p>
<h4 id="inLine关键字">inLine关键字</h4><p>上面的例子就是标准的内联函数的用法，使用inline修饰带来的好处我们表面看不出来，其实在内部的工作就是在每个for循环的内部任何调用dbtest(i)的地方都换成了(i%2&gt;0)?”奇”:”偶”这样就避免了频繁调用函数对栈内存重复开辟所带来的消耗。<br>inline的使用是有所限制的，inline只适合涵数体内代码简单的涵数使用，不能包含复杂的结构控制语句例如while、switch，并且不能内联函数本身不能是直接递归函数(自己内部还调用自己的函数)。</p>
<p>inline函数仅仅是一个建议,对编译器的建议,所以最后能否真正内联,看编译器的意思,它如果认为函数不复杂,能在调用点展开,就会真正内联,并不是说声明了内联就会内联,声明内联只是一个建议而已.<br>其次,因为内联函数要在调用点展开,所以编译器必须随处可见内联函数的定义,要不然,就成了非内联函数的调用了.所以,这要求每个调用了内联函数的文件都出现了该内联函数的定义。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-基础知识" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/10/基础知识/" class="article-date">
  	<time datetime="2015-07-10T08:25:08.000Z" itemprop="datePublished">7月 10 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="基础知识">基础知识</h2><h3 id="单例">单例</h3><p>+(XXXManager <em>)sharedInstance<br>{<br>    static XXXManager </em>sharedManager;</p>
<pre><code><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;
<span class="built_in">dispatch_once</span>(&amp;onceToken, ^{
    sharedManager = [[XXXManager alloc] init];
});

<span class="keyword">return</span> sharedManager;
</code></pre><p>}</p>
<h3 id="方法废弃">方法废弃</h3><p><code>+ (MWPhoto *)photoWithFilePath:(NSString *)path  __attribute__((deprecated(&quot;Use photoWithURL: with a file URL&quot;)));</code></p>
<h4 id="向类或者是实例发送消息">向类或者是实例发送消息</h4><ol>
<li>不论是实例对象还是Class，都是id类型的对象（Class同样是对象）</li>
<li>实例对象的isa指向它的Class（-储存所有减号方法）,Class对象的isa指向<strong>元类</strong>（+储存所有加号方法）</li>
<li>向一个对象（id类型）发送消息时，都是从这个对象的isa指针指向的Class中寻找方法</li>
<li>由于objc对这块的设计是，<strong>NSObject的元类的父类是NSObject类</strong>（也就是我们熟悉的NSObject类），其中有所有的实例方法，因此找到了- responseToSelector</li>
</ol>
<p>实例方法是一条线，类方法是另外一条线</p>
<h4 id="view的懒加载">view的懒加载</h4><p>我们知道，ViewController的view初始化大概流程是：</p>
<ul>
<li>(UIView <em>)view<br>{<br>if (!_view) {<br>  [self loadView];<br>  [self viewDidLoad]; //<br>}<br>}<br>所以在外部执行到vc.view.frame = CGRectMake(0, 0, 100, 100);这句话时，在赋值操作执行前，viewDidLoad就已经被调用，因而在viewDidLoad中对view frame的取值都是默认值（window的大小），而非设定值。 <em>*懒加载问题</em></em></li>
</ul>
<p>dispatch_sync调用结束执行block    block执行完才能继续回到调用点</p>
<p>dispatch_sync在等待block语句执行完成，而block语句需要在主线程里执行，所以dispatch_sync如果在主线程调用就会造成死锁</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-lldb" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/09/lldb/" class="article-date">
  	<time datetime="2015-07-09T09:33:42.000Z" itemprop="datePublished">7月 9 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="lldb">lldb</h3><ol>
<li><strong>frame variable</strong>查看程序当前状态下所有变量的值</li>
<li>po item</li>
<li><strong>bt</strong> 查看程序运行的调用栈</li>
<li>frame variable *self</li>
<li>image命令的用法也挺多，首先可以用它来查看工程中使用的库，image list</li>
<li>找到错误(lldb) image lookup —address 0x0000000100000de0</li>
<li>cmd+k快速清除log信息</li>
<li>pviews查看视图层级</li>
<li>border 0x79ec3140 -c green -w 2 加边框</li>
<li>pinternals 这个命令就是打印出来的一个控件（id）类型的内部结构，</li>
<li>presponder 打印出一个集成于UIResponder控件的消息传递链。</li>
<li>pclass pclass可以打印出一个对象的继承关系。</li>
<li>taplog 这个命令是模拟敲击一下屏幕，并且打印出你敲击屏幕时候事件接收的对象</li>
<li>visualize 可以使用mac下的预览app打开我们的图片UIImage, CGImageRef格式的图片，甚至view和layer的图片 。visualize 0x79ec3140//或者变量名，此地址是id类型的</li>
<li><strong>hide&amp;show</strong> hide命令可以直接隐藏一个对象,移除当前遮挡的对象便于你观察后面的对象。show命令会让它再次显示出来</li>
<li>vs，fv,fvc，这几个命令都需要正则表达式的知识背景</li>
<li><strong>pvc</strong>这个命令的作用是打印出当前的控制器层级</li>
<li><img src="http://m3.img.srcdd.com/farm4/d/2015/0212/13/E505902B1D8D75A1B63C5611BF482417_ORIG_1490_964.gf" alt="po"></li>
<li>p是打印非对象的值</li>
<li>po [[self view] recursiveDescription]</li>
<li>expr — (void) printf(“[%s %s]\n”, (char <em>)object_getClassName(</em>(long<em>)($esp+4)), </em>(long *)($esp+8))</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-autolayout" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/06/autolayout/" class="article-date">
  	<time datetime="2015-07-06T07:09:02.000Z" itemprop="datePublished">7月 6 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="AutoLayout">AutoLayout</h2><h4 id="三种约束情况">三种约束情况</h4><ol>
<li>固定左右和顶部，等宽高</li>
<li>固定顶，左，宽高固定</li>
<li>中心 顶部 宽度 高度</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-问题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/29/问题/" class="article-date">
  	<time datetime="2015-06-29T08:30:56.000Z" itemprop="datePublished">6月 29 2015</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="问题">问题</h2><ol>
<li>implicit declaration of function ‘NSApplicationMain’ is invalid in C99  解决方案： 导入 #import <cocoa cocoa.h=""> </cocoa></li>
<li>@import Foundation 和#import</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 swagon
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>